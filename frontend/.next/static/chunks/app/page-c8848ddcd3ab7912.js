(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{285:(e,t,s)=>{"use strict";s.d(t,{$:()=>c});var r=s(5155),a=s(2115),n=s(9708),o=s(2085),i=s(9434);let l=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:s,variant:a,size:o,asChild:c=!1,...d}=e,u=c?n.DX:"button";return(0,r.jsx)(u,{className:(0,i.cn)(l({variant:a,size:o,className:s})),ref:t,...d})});c.displayName="Button"},697:(e,t,s)=>{"use strict";var r;s.d(t,{AT:()=>o,hD:()=>n});let a=(null==(r=s(7358).env.NEXT_PUBLIC_API_BASE_URL)?void 0:r.replace(/\/$/,""))||"http://localhost:4000";class n extends Error{constructor(e,t,s){super(e),this.name="ApiError",this.status=t,this.data=s}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(a).concat(e.startsWith("/")?e:"/".concat(e)),r=new Headers(t.headers||{});t.body instanceof FormData||r.set("Content-Type","application/json"),r.set("Accept","application/json"),t.token&&r.set("Authorization","Bearer ".concat(t.token));let o=await fetch(s,{...t,headers:r,next:{revalidate:0}}),i=o.headers.get("content-type"),l=(null==i?void 0:i.includes("application/json"))?await o.json():void 0;if(!o.ok)throw new n((null==l?void 0:l.message)||"Request failed with status ".concat(o.status),o.status,l);return l}},1394:(e,t,s)=>{"use strict";s.d(t,{BK:()=>l,eu:()=>i,q5:()=>c});var r=s(5155),a=s(2115),n=s(8513),o=s(9434);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.bL,{ref:t,className:(0,o.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a})});i.displayName=n.bL.displayName;let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n._V,{ref:t,className:(0,o.cn)("aspect-square h-full w-full",s),...a})});l.displayName=n._V.displayName;let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.H4,{ref:t,className:(0,o.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a})});c.displayName=n.H4.displayName},1776:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>d,Z:()=>u});var r=s(5155),a=s(2115);let n="anonymous-social-session";function o(e){localStorage.setItem(n,JSON.stringify(e))}function i(){localStorage.removeItem(n)}var l=s(2370);let c=(0,a.createContext)(void 0);function d(e){let{children:t}=e,[s,d]=(0,a.useState)(null),[u,f]=(0,a.useState)(null),[m,p]=(0,a.useState)(!0),[h,v]=(0,a.useState)(null),g=(0,a.useCallback)(async()=>{let e=function(){let e=localStorage.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch(e){return localStorage.removeItem(n),null}}();if(!e)return void p(!1);d(e.user),f(e.token);try{let t=await (0,l.rQ)(e.token);d(t),o({token:e.token,user:t}),v(null)}catch(e){console.error("[AuthProvider] Failed to refresh user",e),i(),d(null),f(null),v("Session expired. Please sign in again.")}finally{p(!1)}},[]);(0,a.useEffect)(()=>{g()},[g]);let x=(0,a.useCallback)(e=>{o(e),d(e.user),f(e.token),v(null)},[]),y=(0,a.useCallback)(()=>{i(),d(null),f(null)},[]),w=(0,a.useCallback)(async()=>{if(u)try{p(!0);let e=await (0,l.rQ)(u);d(e),o({token:u,user:e}),v(null)}catch(e){console.error("[AuthProvider] refreshUser failed",e),y()}finally{p(!1)}},[u,y]),b=(0,a.useMemo)(()=>({user:s,token:u,loading:m,error:h,setSession:x,signOut:y,refreshUser:w}),[s,u,m,h,x,y,w]);return(0,r.jsx)(c.Provider,{value:b,children:t})}function u(){let e=(0,a.useContext)(c);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}},2370:(e,t,s)=>{"use strict";s.d(t,{Hh:()=>a,Jv:()=>n,rQ:()=>o});var r=s(697);async function a(e){return(0,r.AT)("/api/auth/signup",{method:"POST",body:JSON.stringify(e)})}async function n(e){return(0,r.AT)("/api/auth/login",{method:"POST",body:JSON.stringify(e)})}async function o(e){return(await (0,r.AT)("/api/auth/me",{method:"GET",token:e})).user}},4335:(e,t,s)=>{"use strict";s.d(t,{DA:()=>o,Lc:()=>c,l2:()=>i,pD:()=>n,pd:()=>l,y9:()=>a});var r=s(697);async function a(){return(await (0,r.AT)("/api/posts")).posts}async function n(e,t){return(0,r.AT)("/api/posts",{method:"POST",body:JSON.stringify({text:e}),token:t})}async function o(e){return(0,r.AT)("/api/users/me",{method:"GET",token:e})}async function i(e,t){return(0,r.AT)("/api/users/".concat(e),{method:"GET",...t&&{token:t}})}async function l(e){return(await (0,r.AT)("/api/posts/me",{method:"GET",token:e})).posts||[]}async function c(e,t){return(await (0,r.AT)("/api/posts/user/".concat(e),{method:"GET",...t&&{token:t}})).posts||[]}},6695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>o,aR:()=>i,wL:()=>u});var r=s(5155),a=s(2115),n=s(9434);let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});o.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...a})});d.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...a})});u.displayName="CardFooter"},7282:(e,t,s)=>{"use strict";s.d(t,{Feed:()=>p});var r=s(5155),a=s(2115),n=s(1394),o=s(6695),i=s(9677),l=s(8817);function c(e){var t;let{post:s}=e,a=s.timestamp?new Date(s.timestamp):null,c=a?(0,i.m)(a,{addSuffix:!0}):"just now",d=null!=(t=s.author.displayName)?t:"Anonymous";return(0,r.jsxs)(o.Zp,{className:"overflow-hidden shadow-md hover:shadow-xl transition-shadow duration-300",children:[(0,r.jsxs)(o.aR,{className:"flex flex-row items-center gap-4 p-4 bg-card",children:[(0,r.jsxs)(n.eu,{className:"h-10 w-10 border",children:[(0,r.jsx)(n.BK,{src:l.G[0].imageUrl,alt:d}),(0,r.jsx)(n.q5,{children:d.charAt(0).toUpperCase()})]}),(0,r.jsxs)("div",{className:"grid gap-1",children:[(0,r.jsx)("p",{className:"font-semibold",children:d}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:c})]})]}),(0,r.jsx)(o.Wu,{className:"p-4 pt-0",children:(0,r.jsx)("p",{className:"whitespace-pre-wrap",children:s.text})})]})}var d=s(8856),u=s(4335),f=s(7481),m=s(697);function p(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)(!0),{toast:o}=(0,f.dj)(),i=(0,a.useCallback)(async()=>{try{n(!0);let e=await (0,u.y9)();t(e)}catch(e){o({title:"Error loading posts",description:e instanceof m.hD?e.message:(null==e?void 0:e.message)||"Failed to load posts",variant:"destructive"})}finally{n(!1)}},[o]);return((0,a.useEffect)(()=>{i()},[i]),(0,a.useEffect)(()=>{let e=()=>i();return window.addEventListener("posts:refresh",e),()=>window.removeEventListener("posts:refresh",e)},[i]),s&&!e)?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(d.E,{className:"h-32 w-full rounded-lg"}),(0,r.jsx)(d.E,{className:"h-24 w-full rounded-lg"}),(0,r.jsx)(d.E,{className:"h-28 w-full rounded-lg"})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[null==e?void 0:e.map(e=>(0,r.jsx)(c,{post:e},e.id)),(null==e?void 0:e.length)===0&&!s&&(0,r.jsxs)("div",{className:"text-center text-muted-foreground py-10",children:[(0,r.jsx)("p",{className:"text-lg",children:"The feed is quiet..."}),(0,r.jsx)("p",{children:"Be the first to share a thought!"})]})]})}},7481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>f});var r=s(2115);let a=0,n=new Map,o=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?o(s):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=i(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||r()}}}),{id:s,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function f(){let[e,t]=r.useState(c);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},8304:(e,t,s)=>{"use strict";s.d(t,{PostForm:()=>h});var r=s(5155),a=s(2115),n=s(1394),o=s(285),i=s(8539),l=s(6695),c=s(7481),d=s(3672),u=s(8817),f=s(1776),m=s(4335),p=s(697);function h(){var e,t,s;let{user:h,token:v}=(0,f.Z)(),g=(0,a.useRef)(null),[x,y]=(0,a.useState)(""),{toast:w}=(0,c.dj)(),[b,N]=(0,a.useState)(!1),j=async e=>{if(e.preventDefault(),h&&v){if(!x||""===x.trim())return void w({title:"Error",description:"Post content cannot be empty.",variant:"destructive"});if(x.trim().length>500)return void w({title:"Error",description:"Post cannot exceed 500 characters.",variant:"destructive"});N(!0);try{var t;await (0,m.pD)(x.trim(),v),null==(t=g.current)||t.reset(),y(""),window.dispatchEvent(new Event("posts:refresh"))}catch(e){w({title:"Error creating post",description:e instanceof p.hD?e.message:(null==e?void 0:e.message)||"Failed to create post",variant:"destructive"})}finally{N(!1)}}};return h?(0,r.jsx)(l.Zp,{className:"mb-8 shadow-md hover:shadow-lg transition-shadow",children:(0,r.jsx)(l.Wu,{className:"p-4",children:(0,r.jsxs)("form",{onSubmit:j,ref:g,className:"flex items-start space-x-4",children:[(0,r.jsxs)(n.eu,{className:"h-10 w-10 border",children:[(0,r.jsx)(n.BK,{src:u.G[0].imageUrl,alt:null!=(t=h.displayName)?t:h.email}),(0,r.jsx)(n.q5,{children:null!=(s=null==(e=h.displayName)?void 0:e.charAt(0).toUpperCase())?s:h.email.charAt(0).toUpperCase()})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(i.T,{name:"text",placeholder:"What's on your mind?",className:"w-full resize-none border-0 bg-transparent p-0 focus:ring-0 focus:outline-none focus-visible:ring-offset-0 focus-visible:ring-0",rows:3,required:!0,disabled:b,value:x,onChange:e=>y(e.target.value)}),(0,r.jsx)("div",{className:"mt-2 flex justify-end",children:(0,r.jsxs)(o.$,{type:"submit",size:"sm",className:"transition-transform hover:scale-105",disabled:b,children:[(0,r.jsx)(d.A,{className:"mr-2 h-4 w-4"}),b?"Posting...":"Post"]})})]})]})})}):(0,r.jsx)(l.Zp,{className:"mb-8 text-center p-6 bg-muted/50",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"Please sign in to share your thoughts."})})}},8539:(e,t,s)=>{"use strict";s.d(t,{T:()=>o});var r=s(5155),a=s(2115),n=s(9434);let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a})});o.displayName="Textarea"},8817:(e,t,s)=>{"use strict";s.d(t,{G:()=>r});let r=JSON.parse('{"o":[{"id":"1","description":"A generic user avatar.","imageUrl":"https://images.unsplash.com/photo-1599566150163-29194dcaad36?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3NDE5ODJ8MHwxfHNlYXJjaHwzfHxwZXJzb24lMjBhdmF0YXJ8ZW58MHx8fHwxNzYzMjY3NDQxfDA&ixlib=rb-4.1.0&q=80&w=1080","imageHint":"person avatar"}]}').o},8856:(e,t,s)=>{"use strict";s.d(t,{E:()=>n});var r=s(5155),a=s(9434);function n(e){let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",t),...s})}},9434:(e,t,s)=>{"use strict";s.d(t,{E:()=>i,cn:()=>n,f:()=>o});var r=s(2596),a=s(9688);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.QP)((0,r.$)(t))}function o(e){try{let t=new Date(e),s=new Date().getTime()-t.getTime(),r=Math.floor(s/1e3),a=Math.floor(r/60),n=Math.floor(a/60),o=Math.floor(n/24),i=Math.floor(o/7),l=Math.floor(o/30),c=Math.floor(o/365);if(r<60)return"just now";if(a<60)return"".concat(a,"m ago");if(n<24)return"".concat(n,"h ago");else if(o<7)return"".concat(o,"d ago");else if(i<4)return"".concat(i,"w ago");else if(l<12)return"".concat(l,"mo ago");else return"".concat(c,"y ago")}catch(e){return"unknown time"}}function i(e,t){return e.length<=t?e:e.slice(0,t).trim()+"..."}},9702:(e,t,s)=>{Promise.resolve().then(s.bind(s,7282)),Promise.resolve().then(s.bind(s,8304))}},e=>{var t=t=>e(e.s=t);e.O(0,[352,724,441,684,358],()=>t(9702)),_N_E=e.O()}]);