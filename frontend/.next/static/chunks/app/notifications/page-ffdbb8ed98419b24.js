(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{157:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(2115);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...h}=e;return(0,r.createElement)("svg",{ref:t,...l,width:s,height:s,stroke:a,strokeWidth:o?24*Number(i)/Number(s):i,className:n("lucide",c),...h},[...u.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(d)?d:[d]])}),o=(e,t)=>{let a=(0,r.forwardRef)((a,l)=>{let{className:o,...c}=a;return(0,r.createElement)(i,{ref:l,iconNode:t,className:n("lucide-".concat(s(e)),o),...c})});return a.displayName="".concat(e),a}},285:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var r=a(5155),s=a(2115),n=a(9708),l=a(2085),i=a(9434);let o=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:l,asChild:c=!1,...d}=e,u=c?n.DX:"button";return(0,r.jsx)(u,{className:(0,i.cn)(o({variant:s,size:l,className:a})),ref:t,...d})});c.displayName="Button"},518:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},639:(e,t,a)=>{"use strict";a.d(t,{C:()=>n});var r=a(2115),s=a(5184);function n(e){let[t,a]=(0,r.useState)(0),[n,l]=(0,r.useState)(!1),i=async()=>{if(!e)return void a(0);try{l(!0);let t=await (0,s.Hs)(e);a(t)}catch(e){console.error("Failed to fetch unread count:",e),a(0)}finally{l(!1)}};return(0,r.useEffect)(()=>{i();let e=setInterval(i,3e4);return()=>clearInterval(e)},[e]),(0,r.useEffect)(()=>{let t=()=>{!document.hidden&&e&&i()};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[e]),{unreadCount:t,loading:n,refreshCount:i,setUnreadCount:a}}},697:(e,t,a)=>{"use strict";var r;a.d(t,{AT:()=>l,hD:()=>n});let s=(null==(r=a(7358).env.NEXT_PUBLIC_API_BASE_URL)?void 0:r.replace(/\/$/,""))||"http://localhost:4000";class n extends Error{constructor(e,t,a){super(e),this.name="ApiError",this.status=t,this.data=a}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(s).concat(e.startsWith("/")?e:"/".concat(e)),r=new Headers(t.headers||{});t.body instanceof FormData||r.set("Content-Type","application/json"),r.set("Accept","application/json"),t.token&&r.set("Authorization","Bearer ".concat(t.token));let l=await fetch(a,{...t,headers:r,next:{revalidate:0}}),i=l.headers.get("content-type"),o=(null==i?void 0:i.includes("application/json"))?await l.json():void 0;if(!l.ok)throw new n((null==o?void 0:o.message)||"Request failed with status ".concat(l.status),l.status,o);return o}},1776:(e,t,a)=>{"use strict";a.d(t,{AuthProvider:()=>d,Z:()=>u});var r=a(5155),s=a(2115);let n="anonymous-social-session";function l(e){localStorage.setItem(n,JSON.stringify(e))}function i(){localStorage.removeItem(n)}var o=a(2370);let c=(0,s.createContext)(void 0);function d(e){let{children:t}=e,[a,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),[f,m]=(0,s.useState)(!0),[p,x]=(0,s.useState)(null),v=(0,s.useCallback)(async()=>{let e=function(){let e=localStorage.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch(e){return localStorage.removeItem(n),null}}();if(!e)return void m(!1);d(e.user),h(e.token);try{let t=await (0,o.rQ)(e.token);d(t),l({token:e.token,user:t}),x(null)}catch(e){console.error("[AuthProvider] Failed to refresh user",e),i(),d(null),h(null),x("Session expired. Please sign in again.")}finally{m(!1)}},[]);(0,s.useEffect)(()=>{v()},[v]);let g=(0,s.useCallback)(e=>{l(e),d(e.user),h(e.token),x(null)},[]),y=(0,s.useCallback)(()=>{i(),d(null),h(null)},[]),w=(0,s.useCallback)(async()=>{if(u)try{m(!0);let e=await (0,o.rQ)(u);d(e),l({token:u,user:e}),x(null)}catch(e){console.error("[AuthProvider] refreshUser failed",e),y()}finally{m(!1)}},[u,y]),b=(0,s.useMemo)(()=>({user:a,token:u,loading:f,error:p,setSession:g,signOut:y,refreshUser:w}),[a,u,f,p,g,y,w]);return(0,r.jsx)(c.Provider,{value:b,children:t})}function u(){let e=(0,s.useContext)(c);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}},1894:(e,t,a)=>{Promise.resolve().then(a.bind(a,7435))},2370:(e,t,a)=>{"use strict";a.d(t,{Hh:()=>s,Jv:()=>n,rQ:()=>l});var r=a(697);async function s(e){return(0,r.AT)("/api/auth/signup",{method:"POST",body:JSON.stringify(e)})}async function n(e){return(0,r.AT)("/api/auth/login",{method:"POST",body:JSON.stringify(e)})}async function l(e){return(await (0,r.AT)("/api/auth/me",{method:"GET",token:e})).user}},3896:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},5184:(e,t,a)=>{"use strict";a.d(t,{Hs:()=>i,bA:()=>n,bb:()=>s,he:()=>l});var r=a(697);async function s(e){return(await (0,r.AT)("/api/notifications",{method:"GET",token:e})).notifications}async function n(e,t){await (0,r.AT)("/api/notifications/".concat(e,"/read"),{method:"PATCH",token:t})}async function l(e){await (0,r.AT)("/api/notifications/read-all",{method:"PATCH",token:e})}async function i(e){return(await (0,r.AT)("/api/notifications/unread-count",{method:"GET",token:e})).count}},6695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>l,aR:()=>i,wL:()=>u});var r=a(5155),s=a(2115),n=a(9434);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});l.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});o.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})});u.displayName="CardFooter"},6931:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])},7435:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var r=a(5155),s=a(6695),n=a(285),l=a(8856),i=a(1776),o=a(639),c=a(3896),d=a(8224),u=a(6931),h=a(7554),f=a(518),m=a(8271),p=a(2115),x=a(5184),v=a(9434);function g(){let{user:e,token:t}=(0,i.Z)(),{refreshCount:a}=(0,o.C)(t),[g,y]=(0,p.useState)([]),[w,b]=(0,p.useState)(!0),[N,j]=(0,p.useState)(!1),[k,A]=(0,p.useState)(!1),[C,E]=(0,p.useState)(null),S=async()=>{if(t)try{E(null);let e=await (0,x.bb)(t);y(e)}catch(e){console.error("Failed to fetch notifications:",e),E("Failed to load notifications")}finally{b(!1),A(!1)}};(0,p.useEffect)(()=>{e&&t?S():b(!1)},[e,t]);let T=async()=>{if(t&&!N)try{j(!0),await (0,x.he)(t),y(e=>e.map(e=>({...e,read:!0}))),a()}catch(e){console.error("Failed to mark all notifications as read:",e)}finally{j(!1)}},M=async e=>{if(t)try{await (0,x.bA)(e,t),y(t=>t.map(t=>t.id===e?{...t,read:!0}:t)),a()}catch(e){console.error("Failed to mark notification as read:",e)}},P=async()=>{t&&!k&&(A(!0),await S())},R=e=>{switch(e){case"follow":return c.A;case"new_post":return d.A;default:return u.A}},_=e=>{let t=e.actor.displayName||"Someone";switch(e.type){case"follow":return"".concat(t," started following you");case"new_post":let a=e.post?(0,v.E)(e.post.text,50):"something new";return"".concat(t,' posted: "').concat(a,'"');default:return"New notification"}};return e?C?(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsx)(s.Zp,{className:"max-w-2xl mx-auto",children:(0,r.jsxs)(s.Wu,{className:"text-center p-8",children:[(0,r.jsx)("p",{className:"text-destructive mb-4",children:C}),(0,r.jsxs)(n.$,{onClick:P,variant:"outline",disabled:k,children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-2 ".concat(k?"animate-spin":"")}),k?"Retrying...":"Retry"]})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,r.jsx)("div",{className:"gradient-card rounded-2xl p-8 shadow-xl",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Notifications"}),(0,r.jsx)("p",{className:"text-slate-600 mt-2",children:"Stay up to date with your activity"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)(n.$,{onClick:P,variant:"ghost",size:"sm",disabled:w||k,className:"hover:bg-gradient-to-r hover:from-blue-500/20 hover:to-purple-500/20 border border-blue-200",children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-2 ".concat(k?"animate-spin":"")}),"Refresh"]}),(0,r.jsxs)(n.$,{onClick:T,variant:"outline",size:"sm",disabled:N||g.every(e=>e.read),className:"bg-gradient-to-r from-green-500/10 to-emerald-500/10 hover:from-green-500/20 hover:to-emerald-500/20 border-green-300",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 mr-2"}),N?"Marking...":"Mark all read"]}),(0,r.jsxs)(n.$,{variant:"outline",size:"sm",className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 hover:from-purple-500/20 hover:to-pink-500/20 border-purple-300",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Settings"]})]})]})}),(0,r.jsx)("div",{className:"space-y-4",children:w?(0,r.jsx)("div",{className:"space-y-4",children:Array.from({length:5}).map((e,t)=>(0,r.jsx)("div",{className:"gradient-card rounded-xl p-6 shadow-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)(l.E,{className:"h-10 w-10 rounded-full"}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)(l.E,{className:"h-4 w-3/4"}),(0,r.jsx)(l.E,{className:"h-3 w-1/2"})]})]})},t))}):g.length>0?(0,r.jsx)("div",{className:"space-y-4",children:g.map(e=>{let t=R(e.type);return(0,r.jsx)(s.Zp,{className:"gradient-card rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1 ".concat(e.read?"":"ring-2 ring-blue-500/50 bg-gradient-to-r from-blue-50/80 to-purple-50/80"),onClick:()=>!e.read&&M(e.id),children:(0,r.jsx)(s.Wu,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("div",{className:"p-3 rounded-full shadow-lg ".concat(e.read?"bg-gradient-to-r from-slate-400 to-slate-500 text-white":"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-blue-500/25"),children:(0,r.jsx)(t,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"font-semibold text-slate-800",children:_(e)}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-slate-500 bg-slate-100/50 px-2 py-1 rounded-full",children:(0,v.f)(e.createdAt)}),!e.read&&(0,r.jsx)("div",{className:"h-3 w-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full notification-pulse"})]})]}),"new_post"===e.type&&e.post&&(0,r.jsxs)("p",{className:"text-sm text-slate-600 bg-slate-50/50 p-3 rounded-lg",children:['"',(0,v.E)(e.post.text,80),'"']})]})]})})},e.id)})}):(0,r.jsx)(s.Zp,{className:"gradient-card rounded-xl shadow-lg",children:(0,r.jsxs)(s.Wu,{className:"text-center py-16",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("div",{className:"mx-auto w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center shadow-lg",children:(0,r.jsx)(u.A,{className:"h-8 w-8 text-white"})})}),(0,r.jsx)(s.ZB,{className:"mb-2 text-2xl bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"No notifications"}),(0,r.jsx)(s.BT,{className:"text-lg text-slate-600",children:"You're all caught up! When you have new activity, it'll appear here."})]})})})]})})}):(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsx)(s.Zp,{className:"max-w-2xl mx-auto",children:(0,r.jsx)(s.Wu,{className:"text-center p-8",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"Please log in to view your notifications."})})})})}},7554:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8224:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},8271:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},8856:(e,t,a)=>{"use strict";a.d(t,{E:()=>n});var r=a(5155),s=a(9434);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-muted",t),...a})}},9434:(e,t,a)=>{"use strict";a.d(t,{E:()=>i,cn:()=>n,f:()=>l});var r=a(2596),s=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}function l(e){try{let t=new Date(e),a=new Date().getTime()-t.getTime(),r=Math.floor(a/1e3),s=Math.floor(r/60),n=Math.floor(s/60),l=Math.floor(n/24),i=Math.floor(l/7),o=Math.floor(l/30),c=Math.floor(l/365);if(r<60)return"just now";if(s<60)return"".concat(s,"m ago");if(n<24)return"".concat(n,"h ago");else if(l<7)return"".concat(l,"d ago");else if(i<4)return"".concat(i,"w ago");else if(o<12)return"".concat(o,"mo ago");else return"".concat(c,"y ago")}catch(e){return"unknown time"}}function i(e,t){return e.length<=t?e:e.slice(0,t).trim()+"..."}}},e=>{var t=t=>e(e.s=t);e.O(0,[352,441,684,358],()=>t(1894)),_N_E=e.O()}]);